# 增强搜索功能使用指南

## 🔍 新增功能

SVD图形化查看器现在支持**三种搜索模式**：

### 1️⃣ 普通搜索（默认）
最基础的搜索方式，不区分大小写的文本包含匹配。

**示例：**
- 搜索 `uart` → 匹配 UART1, UART2, uart_ctrl 等
- 搜索 `0x4000` → 匹配所有包含此地址段的寄存器

**适用场景：**
- 快速查找已知名称的外设或寄存器
- 搜索地址段
- 简单的关键词搜索

---

### 2️⃣ 正则表达式搜索
支持完整的正则表达式语法，强大的模式匹配功能。

**示例：**

| 正则表达式 | 匹配内容 | 说明 |
|-----------|---------|------|
| `^ADC` | ADC1, ADC2 | 以ADC开头的外设 |
| `CTRL\d+` | CTRL1, CTRL2, CTRL_STS | 包含CTRL后跟数字 |
| `T[23].*` | T2CON, T3CON, TIMER2, TIMER3 | T2或T3开头 |
| `.*_STS$` | CTRL_STS, GLOB_STS | 以_STS结尾 |
| `0x4[0-9A-F]{7}` | 0x40004000, 0x48020000 | 特定地址范围 |
| `CH[0-7]` | CH0, CH1, ..., CH7 | 通道0-7 |
| `(UART\|SSC\|SPI)` | UART1, SSC1, SPI2 | 匹配多个模块之一 |

**正则语法快速参考：**
- `.` - 任意单个字符
- `*` - 前面的字符出现0次或多次
- `+` - 前面的字符出现1次或多次
- `?` - 前面的字符出现0次或1次
- `^` - 行首
- `$` - 行尾
- `[abc]` - 匹配a、b或c
- `[0-9]` - 匹配任意数字
- `[A-Z]` - 匹配任意大写字母
- `\d` - 数字 (等同于[0-9])
- `\w` - 字母数字下划线
- `(a|b)` - 匹配a或b

**适用场景：**
- 查找符合特定模式的寄存器
- 批量查找类似名称的外设
- 复杂的条件匹配

---

### 3️⃣ 模糊搜索
基于字符串相似度的智能匹配，即使拼写不完全准确也能找到相关结果。

**工作原理：**
使用 SequenceMatcher 算法计算相似度，相似度 ≥ 60% 即为匹配。

**示例：**

| 搜索关键词 | 可能匹配 | 相似度 |
|-----------|----------|-------|
| `uartcon` | UART_CON, UARTCON1 | 高 |
| `timr` | TIMER, TIMER2, TIMER3 | 中高 |
| `adcctrl` | ADC_CTRL, ADC1_CTRL | 高 |
| `globctr` | GLOBCTR, GLOB_CTRL | 高 |
| `intrupt` | INTERRUPT, INT_CTRL | 中 |

**适用场景：**
- 记不清确切名称时
- 探索性搜索
- 快速定位类似功能的寄存器

---

## 🎯 使用方法

### 步骤1：选择搜索模式
在搜索框右侧，选择三个单选按钮之一：
- ⭕ **普通** - 默认模式
- ⭕ **正则** - 正则表达式
- ⭕ **模糊** - 模糊匹配

### 步骤2：输入搜索内容
在搜索框中输入：
- 普通模式：直接输入关键词
- 正则模式：输入正则表达式
- 模糊模式：输入大致名称

### 步骤3：查看结果
- 匹配项会以**黄色背景**高亮显示
- 父节点会自动展开
- 状态栏显示：`[模式] 找到 X 个匹配项`

### 步骤4：清除搜索
点击 "✖ 清除" 按钮恢复原始视图

---

## 💡 实用技巧

### 技巧1：组合使用
1. 先用**普通搜索**快速定位大致范围
2. 切换到**正则搜索**精确匹配
3. 不确定时用**模糊搜索**探索

### 技巧2：正则搜索常用模式

**查找所有中断相关寄存器：**
```
.*INT.*|.*IRQ.*|.*ISR.*
```

**查找所有控制寄存器：**
```
.*CTRL$|.*CON$|.*CONTROL.*
```

**查找所有状态寄存器：**
```
.*STS$|.*STAT.*|.*STATUS.*
```

**查找特定位宽寄存器（如32位）：**
```
32 bits
```

**查找特定地址范围（如0x4000xxxx）：**
```
0x4000[0-9A-F]{4}
```

### 技巧3：模糊搜索优化
- 输入核心关键词即可，如 `timer` 而非 `TIMER2_CTRL`
- 保持3-6个字符通常效果最好
- 避免过短（如1-2字符），会匹配太多

### 技巧4：搜索地址
普通模式下，直接输入地址片段：
- `0x40` - 查找0x40开头的所有地址
- `4000` - 查找包含4000的地址

---

## 🔧 高级示例

### 示例1：查找所有定时器相关模块
**正则表达式：**
```
^(TIMER|GPT|CCU).*
```
匹配：TIMER2, TIMER21, TIMER3, GPT12E, CCU6

### 示例2：查找所有ADC通道寄存器
**正则表达式：**
```
CH[0-9](_|$)
```
匹配：CH0, CH1, CH2, ..., CH0_EIM, CH1_ESM 等

### 示例3：查找所有复位相关寄存器
**正则表达式：**
```
.*RE(SE)?T.*
```
匹配：RESET, RST, RSTCON, RESET_STS 等

### 示例4：模糊搜索通信模块
**搜索词：** `uart`
**模糊匹配：** UART1, UART2, SCON (串口控制)

---

## 📊 搜索模式对比

| 特性 | 普通搜索 | 正则搜索 | 模糊搜索 |
|-----|---------|---------|---------|
| **搜索范围** | **仅名称** | **仅名称** | **仅名称** |
| 易用性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| 精确度 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| 灵活性 | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| 速度 | 快 | 中 | 中 |
| 需要学习 | 否 | 是 | 否 |

> **注意**：所有搜索模式下，程序**仅匹配寄存器/外设名称**，不会搜索地址或描述信息。

---

## ⚠️ 注意事项

1. **正则表达式错误**：如果正则表达式语法错误，状态栏会显示错误信息

2. **性能考虑**：
   - 模糊搜索在大型SVD文件中可能稍慢
   - 复杂的正则表达式可能影响性能

3. **大小写**：
   - 普通搜索：不区分大小写
   - 正则搜索：默认不区分（使用了 re.IGNORECASE）
   - 模糊搜索：不区分大小写

4. **实时搜索**：输入时即刻搜索，无需按回车

---

## 🎓 学习资源

### 正则表达式学习
- [RegexOne 交互教程](https://regexone.com/)
- [Regex101 在线测试](https://regex101.com/)
- Python re 模块文档

### 快速测试
在搜索框中尝试以下示例：
1. 普通：`TIMER`
2. 正则：`TIMER\d+`
3. 模糊：`timr`

观察不同模式的搜索结果差异！

---

## 📝 常见问题

**Q: 如何切换搜索模式？**
A: 点击搜索框右侧的单选按钮（普通/正则/模糊）

**Q: 正则表达式太难了，有简单方法吗？**
A: 使用模糊搜索！它能在不了解正则的情况下实现智能匹配

**Q: 为什么有些寄存器没匹配到？**
A: 检查搜索模式是否正确，尝试使用模糊搜索扩大范围

**Q: 可以搜索描述内容吗？**
A: 可以！所有三种模式都会搜索名称、地址和描述

---

## 🚀 快捷键提示

虽然目前没有键盘快捷键，但建议的工作流程：
1. `Tab` 键快速切换到搜索框
2. 输入搜索内容
3. 用鼠标或方向键选择匹配项
4. `Esc` 或点击"清除"恢复视图

好好享受增强的搜索功能吧！🎉
